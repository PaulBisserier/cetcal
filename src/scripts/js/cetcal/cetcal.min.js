/* ****************************************************
 * Setups.
 * ****************************************************/
$('.carousel').carousel( { interval: 2000 } );

function scrollTowards(id) {
	$('html, body').animate({
	    scrollTop: ($('#' + id).offset().top)
	}, 1200);
}

$(document).ready(function(){
	
	$('a.scrolltowards').click(function(e) {
		e.preventDefault();
		$("html, body").animate({ scrollTop: $($(this).attr("href")).offset().top - 120 }, 500);
	})
	$('#cet-notre-projet').on('mousedown', function(e) {
	    $('#modal-cet-notre-projet-btn').click(); 
    });
    $('#cet-notre-projet-union-eu').on('mousedown', function(e) {
	    $('#modal-cet-notre-projet-btn').click();
    });
    $('#cet-notre-projet-region').on('mousedown', function(e) {
	    $('#modal-cet-notre-projet-btn').click();
    });
	$('.cet-conditions-donnees-numerique').on('mousedown', function(e) {
	   $('#modal-cet-vos-donnees-btn').click();
    });    
    $('#cet-annuaire-crt-recherche-btn').on('mousedown', function(e) {
        $('#cet-qstprod_intro').hide('slow'); 
        $('#cet-qstprod_seconnecter').hide('slow');
        cetcrtmainmap.setView([44.854, -0.043], 10);
    });
    $('#cet-inscription-producteur').on('mousedown', function(e) {
        $('#cet-qstprod_seconnecter').hide();
        scrollTowards('cet-annuaire-body');
        $('#cet-qstprod_intro').fadeIn('slow');
    });
});

$(document).on("keydown", "form", function(event) { 
    return event.key != "Enter";
});

/* ****************************************************
 * Form checking.
 * ****************************************************/
function checkFormInput(maxl, id) {
	var l = $('#' + id).val().length;
	if (l > 1 && l <= maxl) { 
		displayValidFormInput(id);
	} else { 
		displayInvalidFormInput(id); 
	}
	return;
}

function checkFormInputInteger(maxl, minl, id) {
	var l = $('#' + id).val().length;
	if ((l >= minl && l <= maxl) && $.isNumeric($('#' + id).val())) { 
		displayValidFormInput(id);
	} else { 
		displayInvalidFormInput(id); 
	}
	return;
}

function checkFormInputMin(maxl, minl, id) {
	var l = $('#' + id).val().length;
	if (l > 1 && l <= maxl && l >= minl) { 
		displayValidFormInput(id);
	} else { 
		displayInvalidFormInput(id); 
	}
	return;
}

function checkSiret(id) {
	var l = $('#' + id).val().length;
	if (l === 14 && $.isNumeric($('#' + id).val())) { 
		displayValidFormInput(id);
	} else { 
		if (l > 0) {
			$('#modal-questionaire-titre').text('N° de SIRET invalid');
			$('#modal-questionaire-paragraphe').text("Le siret saisie n'est pas un siret valide. Un Siret comporte 14 chiffres et aucune lettre ou caractère. Veuillez rectifier votre saisie.");
			$('#modal-questionaire-btn-primary').text("J'ai compris");
			$('#modal-questionaire-btn').click(); 
		}
	}
	return; 
}

function checkMotsDePasse(maxl, minl, id, idconf) {
	var mdp = $('#' + id).val();
	var mdpconf = $('#' + idconf).val();
	if ((mdp.length >= minl && mdpconf.length > 0) && mdp != mdpconf) {
		displayInvalidFormInput(idconf);
		$('#modal-questionaire-titre').text('Mots de passe non identiques');
		$('#modal-questionaire-paragraphe').text("Le mot de passe de confirmation de correspond pas au mot de passe saisie. Veuillez vérifier vos saisies. Le mot de passe doit contenir au minimum 8 caractères.");
		$('#modal-questionaire-btn-primary').text("J'ai compris");
		$('#modal-questionaire-btn').click();
		return;
	} else {
		checkFormInputMin(maxl, minl, idconf);
	}
}

function checkValidEmail(maxl, id) {
	var l = $('#' + id).val().length;
	var regex = /^([a-zA-Z0-9_.+-])+\@(([a-zA-Z0-9-])+\.)+([a-zA-Z0-9]{2,4})+$/;
	if (regex.test($('#' + id).val()) && l <= maxl) {
		displayValidFormInput(id);
	} else {
		displayInvalidFormInput(id);
	} 
}

function checkFRDateFormat(obl, id) {

	var l = $('#' + id).val().length;
	if (!obl && l <= 0) { 
		removeValidInvalidDisplay(id);
		return;
	}

	var date = $('#' + id).val();
	var regex = /^([0-2][0-9]|(3)[0-1])(\/)(((0)[0-9])|((1)[0-2]))(\/)\d{4}$/;
	if (regex.test(date) && l == 10 && l == 10) {
		displayValidFormInput(id);
	} else {
		displayInvalidFormInput(id);
		if (l > 0) {
			$('#modal-questionaire-titre').text('Probléme avec la date "' + date + '"');
			$('#modal-questionaire-paragraphe').text("Le format de la date doit être de type jour/mois/année. Veuillez vérifier votre saiaie.");
			$('#modal-questionaire-btn-primary').text("J'ai compris");
			$('#modal-questionaire-btn').click();
		}
	}  
}

function checkValidEmailConfirmation(maxl, id, idconf) {

	if ($('#' + idconf).val().length === 0 && $('#' + id).val().length === 0) { 
		return; 
	} else {
		if ($('#' + id).val() != $('#' + idconf).val()) {
			clearValidInput(id); 
			clearValidInput(idconf);
			$('#modal-questionaire-titre').text('E-mails non identiques');
			$('#modal-questionaire-paragraphe').text("L'e-mail de confirmation de correspond pas à l'e-mail saisie. Veuillez vérifier vos saisies.");
			$('#modal-questionaire-btn-primary').text("J'ai compris");
			$('#modal-questionaire-btn').click();
			return;
		} else {
			var regex = /^([a-zA-Z0-9_.+-])+\@(([a-zA-Z0-9-])+\.)+([a-zA-Z0-9]{2,4})+$/;
			if (regex.test($('#' + id).val()) && regex.test($('#' + idconf).val())) {
				addValidInput(id);
				addValidInput(idconf);
			} else {
				clearValidInput(id);
				clearValidInput(idconf);
				$('#modal-questionaire-titre').text('Erreur sur saisie E-mail');
				$('#modal-questionaire-paragraphe').text("L'e-mail saisie contient une erreur. Veuillez vérifier vos saisies.");
				$('#modal-questionaire-btn-primary').text("J'ai compris");
				$('#modal-questionaire-btn').click();
				return;
			}
		}
	}
}

function addValidInput(id) {
	$('#' + id).addClass('is-valid');
}

function clearValidInput(id) {
	$('#' + id).removeClass('is-valid');
}

function displayInvalidFormInput(id) {
	$('#' + id).removeClass('is-valid');
	$('#' + id).addClass('is-invalid'); 
}

function displayValidFormInput(id) {
	$('#' + id).removeClass('is-invalid');
	$('#' + id).addClass('is-valid'); 
}

function removeValidInvalidDisplay(id) {
	$('#' + id).removeClass('is-invalid');
	$('#' + id).removeClass('is-valid');
}